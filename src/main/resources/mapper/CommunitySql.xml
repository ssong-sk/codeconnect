<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.code.mapper.CommunityMapperInter">
    <select id="getTotalCount" resultType="int">
        select count(*) from community
    </select>
    
    <insert id="insertCommunity" parameterType="CommunityDto">
        insert into community (com_user_id, com_nickname, com_title, com_content, com_photo, com_category, com_writetime, com_updatetime, com_post_type,
        com_name, com_companyname) 
        values (#{com_user_id}, #{com_nickname}, #{com_title}, #{com_content}, #{com_photo}, #{com_category}, now(), now(), #{com_post_type},
        #{com_name}, #{com_companyname})
    </insert>
    
    <!-- <insert id="insertCommunity" parameterType="com.code.dto.CommunityDto">
	    insert into community (com_num, com_category, com_title, com_content, com_photo, com_post_type)
	    values (#{com_num}, #{com_category}, #{com_title}, #{com_content}, #{com_photo}, #{com_post_type})
	</insert> -->
    
    <select id="getAllDatas" resultType="CommunityDto">
        select * from community order by com_num desc
    </select>
    
    <select id="getData" parameterType="int" resultType="CommunityDto">
        select * from community where com_num = #{com_num}
    </select>
    <update id="updateCommunity" parameterType="CommunityDto">
        update community set 
        	com_photo = #{com_photo}, com_title = #{com_title}, com_content = #{com_content},
            com_category = #{com_category}, com_post_type = #{com_post_type}, com_updatetime = now()
        where com_num = #{com_num}
    </update>
    
    <delete id="deleteCommunity" parameterType="String">
        delete from community where com_num = #{com_num}
    </delete>
    
    <!-- interview 목록을 가져오는 쿼리 추가 -->
    <select id="getInterviews" resultType="CommunityDto">
    	select * from community where com_post_type = 'interview'
    </select>
    
    <!-- post_type 가져오는 쿼리 -->
    <select id="getTotalCountByType" parameterType="String" resultType="int">
        select count(*) from community where com_post_type = #{type}
    </select>
    
    <select id="getAllDatasByType" parameterType="String" resultType="CommunityDto">
        select * from community where com_post_type = #{type} order by com_num desc
    </select>
    <!-- 카테고리별 데이터 조회 쿼리 추가 -->
    <select id="getAllDatasByCategory" parameterType="String" resultType="CommunityDto">
    	select * from community where com_category = #{category} order by com_num desc
    </select>
    <update id="increaseReadCount" parameterType="int">
    	update community set com_readcount = com_readcount+1
    	where com_num = #{com_num}
    </update>
    <!-- homedetail 좋아요 수 증가 -->
    <update id="updateLikeCount" parameterType="int">
    	update community set com_likes = com_likes+1
    	where com_num = #{com_num}
    </update>
    <update id="decreaseLikeCount">
    	update community set com_likes = com_likes-1
    	where com_num = #{com_num}
    </update>
</mapper>